#!/usr/bin/env pwsh

function Run-Command {
    [CmdletBinding()]
    param (
        [Parameter(Mandatory=$true)]
        [string]$Command,

        [Parameter(Mandatory=$true)]
        [string]$Args
    )

    # Support pipeline input
    if ($MyInvocation.ExpectingInput) {
        $input | & $Command $Args
    } else {
        & $Command $Args
    }

    $LASTEXITCODE
}

$basedir = Split-Path $MyInvocation.MyCommand.Definition -Parent
$exe = if ($PSVersionTable.PSVersion -lt "6.0" -or $IsWindows) { ".exe" } else { "" }
$nodeCommand = "$basedir/node$exe"

if (!(Test-Path $nodeCommand)) {
    Write-Error "Node.js executable not found in '$nodeCommand'"
    exit 1
}

$sucraseCommand = "$basedir/../sucrase/bin/sucrase"
$ret = Run-Command -Command $nodeCommand -Args "$sucraseCommand $args"

exit $ret
