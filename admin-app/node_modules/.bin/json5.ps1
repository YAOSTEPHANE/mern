#!/usr/bin/env pwsh

$scriptPath = Split-Path $MyInvocation.MyCommand.Definition -Parent
$nodeExe = if ($PSVersionTable.PSVersion -lt "6.0" -or $IsWindows) { ".exe" } else { "" }
$json5CliPath = Join-Path $scriptPath "../json5/lib/cli.js"

function Invoke-Json5Cli {
  [CmdletBinding()]
  param(
    [Parameter(ValueFromPipeline=$true)]
    [object]$inputObject
  )

  $process = Start-Process -FilePath (Join-Path $scriptPath "node$nodeExe") -ArgumentList $json5CliPath, $args -NoNewWindow -RedirectStandardOutput $null -PassThru
  $process.WaitForExit()
  $process.ExitCode
}

if ($MyInvocation.ExpectingInput) {
  $input | Invoke-Json5Cli @args
} else {
  Invoke-Json5Cli @args
}
