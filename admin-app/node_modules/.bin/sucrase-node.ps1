#!/usr/bin/env pwsh

$basedir = Split-Path $MyInvocation.MyCommand.Definition -Parent
$exe = if ($PSVersionTable.PSVersion -lt "6.0" -or $IsWindows) { ".exe" } else { "" }

function Invoke-Node {
    param([string]$nodeExe, [string]$sucraseExe, [string[]]$args)

    if (-not (Test-Path "$nodeExe$exe")) {
        Write-Error "Node.js executable not found: $nodeExe$exe"
        exit 1
    }

    # Support pipeline input
    if ($MyInvocation.ExpectingInput) {
        $input | & "$nodeExe$exe" "-f" "$sucraseExe" $args
    } else {
        & "$nodeExe$exe" "-f" "$sucraseExe" $args
    }

    $LASTEXITCODE
}

$ErrorActionPreference = 'Stop'
$ret = Invoke-Node -nodeExe "$basedir/node" -sucraseExe "$basedir/../sucrase/bin/sucrase-node" $args
exit $ret
