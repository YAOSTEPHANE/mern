#!/usr/bin/env pwsh

$basedir = Split-Path $MyInvocation.MyCommand.Definition -Parent
$exe = if ($PSVersionTable.PSVersion -lt "6.0" -or $IsWindows) { ".exe" } else { "" }

function Run-Command {
    param([string]$nodeExe, [string]$jestPath, [object[]]$args)

    if (-not (Test-Path $nodeExe)) {
        Write-Error "Node.js executable not found: $nodeExe"
        exit 1
    }

    if (-not (Test-Path $jestPath)) {
        Write-Error "Jest command not found: $jestPath"
        exit 1
    }

    & $nodeExe $jestPath $args
    if ($LASTEXITCODE -ne 0) {
        Write-Error "Jest command failed with exit code $LASTEXITCODE"
        exit $LASTEXITCODE
    }
}

$nodePath = "$basedir/node$exe"
$jestPath = "$basedir/../jest/bin/jest.js"

if ($MyInvocation.ExpectingInput) {
    $input | Run-Command $nodePath $jestPath $args
} else {
    Run-Command $nodePath $jestPath $args
}
