#!/usr/bin/env pwsh
$basedir = Split-Path $MyInvocation.MyCommand.Definition -Parent

function Run-Command {
    [CmdletBinding()]
    param(
        [Parameter(Mandatory=$true)]
        [string]$Exe,
        [Parameter(Mandatory=$true)]
        [string]$Module,
        [string[]]$Args
    )

    if (-not (Test-Path "$Exe")) {
        Write-Error "Node executable not found: $Exe"
        return 1
    }

    if (-not (Get-Module -Name $Module -ListAvailable)) {
        Write-Error "Module not found: $Module"
        return 1
    }

    if ($MyInvocation.ExpectingInput) {
        $input | & $Exe $Module $Args
    } else {
        & $Exe $Module $Args
    }

    return $LASTEXITCODE
}

$exe = ""
if ($PSVersionTable.PSVersion -lt "6.0" -or $IsWindows) {
    $exe = ".exe"
}

$ret = Run-Command -Exe "$basedir/node$exe" -Module "$basedir/../loose-envify/cli.js" -Args $args

exit $ret
