"use strict";

const { declare } = require("@babel/helper-plugin-utils");
const parserOptsDefaults = require("@babel/core").parserOptsDefaults;

// Add `importMeta` plugin to the default parser options
const modifyParserOptions = ({ plugins = [] }) => {
  plugins.push("importMeta");
  return { plugins };
};

const plugin = declare((api) => {
  api.assertVersion(7);

  return {
    name: "syntax-import-meta",

    manipulateOptions(opts, parserOpts) {
      return modifyParserOptions(parserOptsDefaults(parserOpts));
    },
  };
});

module.exports = plugin;
