"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.makeStaticFileCache = exports.fileMtime = void 0;

const fs = require("fs");
const caching = require("../caching.js");

function fileMtime(filepath) {
  if (!fs.existsSync(filepath)) return null;

  try {
    const stats = fs.statSync(filepath);
    return stats.mtimeMs;
  } catch (e) {
    if (e.code !== "ENOENT" && e.code !== "ENOTDIR") throw e;
  }

  return null;
}

exports.fileMtime = fileMtime;

function makeStaticFileCache(fn) {
  return caching.makeStrongCache(function* (filepath, cache) {
    const cached = cache.invalidate(() => fileMtime(filepath));

    if (cached === null) {
      return null;
    }

    return fn(filepath, fs.readFileSync(filepath, "utf8"));
  });
}

exports.makeStaticFileCache = makeStaticFileCache;

0 && 0;
