"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.once = void 0;

var _async = require("./async.js");

function once(fn) {
  let result;
  let resultPromise;

  return function* () {
    if (result !== undefined) return result;

    if (!(yield*(0, _async.isAsync)())) return result = yield* fn();

    if (resultPromise) return yield*(0, _async.waitFor)(resultPromise);

    resultPromise = new Promise((resolve, reject) => {
      result = yield* fn().catch(reject);
      resultPromise = null;
      resolve(result);
    });

    return yield* resultPromise;
  };
}

exports.once = once;

//# sourceMappingURL=functional.js.map
