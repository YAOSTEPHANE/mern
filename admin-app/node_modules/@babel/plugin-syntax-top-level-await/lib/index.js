"use strict";

const { declare } = require("@babel/helper-plugin-utils");
const parserPlugins = require("babel-preset-env/lib/plugins");

const topLevelAwaitPlugin = require("babel-plugin-syntax-top-level-await");

const defaultPlugin = (api) => {
  api.assertVersion(7);

  return {
    name: "syntax-top-level-await",

    manipulateOptions(opts, parserOpts) {
      // Only add the topLevelAwait plugin if it's not already included
      if (!parserOpts.plugins.includes(topLevelAwaitPlugin)) {
        parserOpts.plugins.push(topLevelAwaitPlugin);
      }
    }
  };
};

module.exports = declare(defaultPlugin);
