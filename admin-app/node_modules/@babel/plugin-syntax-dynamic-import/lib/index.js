"use strict";

const { declare } = require("@babel/helper-plugin-utils");
const parserPlugins = require("babel-preset-react-app/node_modules/babel-preset-env/lib/plugins");

const defaultPlugin = declare({
  name: "syntax-dynamic-import",

  manipulateOptions(opts, parserOpts) {
    // Add dynamicImport plugin to the list of plugins if it's not already present
    if (!parserOpts.plugins.includes("dynamicImport")) {
      parserOpts.plugins.push("dynamicImport");
    }
  },
});

// Export the plugin with the correct babel version
const babelVersion = parseInt(require("babel-core/package.json").version.split(".")[0]);
const babelPlugin = babelVersion >= 7 ? defaultPlugin : parserPlugins.syntaxDynamicImport;

module.exports = babelPlugin;
